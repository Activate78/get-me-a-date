<!--
  ~ Copyright (c) 2017, Hugo Freire <hugo@exec.sh>.
  ~
  ~ This source code is licensed under the license found in the
  ~ LICENSE file in the root directory of this source tree.
  -->

<!doctype html>
<html ng-app="app">
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.12/angular.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/restangular/1.5.1/restangular.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.2/lodash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-moment/1.0.1/angular-moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-foundation-6/0.11.5/angular-foundation.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.3.1/css/foundation.min.css"/>
    <style>
        ul.no-bullet > li {
            display: inline-block;
        }

        .tint {
            position: relative;
            float: left;
            cursor: pointer;
        }

        .tint:before {
            content: "";
            display: block;
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            transition: all .3s linear;
        }

        .tint:hover:before {
            background: none;
        }

        .pass:before {
            background: rgba(255, 0, 0, 0.5);
        }

        .like:before {
            background: rgba(0, 255, 0, 0.5);
        }

        .train:before {
            background: rgba(255, 255, 0, 0.5);
        }
    </style>
</head>
<body>
<div ng-controller="PeopleController">
    <script type="text/ng-template" id="p.html">
        <h3>{{ p.data.name }}, {{ today | amDifference : p.data.birth_date : 'years' }}</h3>
        <h4>{{ p.data.schools && p.data.schools[0].name || p.data.jobs && p.data.jobs[0].company.name }}</h4>
        <p>{{ p.data.bio }} </p>
        <ul class="no-bullet">
            <li ng-repeat="photo in p.data.photos">
                <img ng-src="{{ photo.url }}"
                     tooltip="Similarity: {{photo.similarity}}%"
                     tooltip-placement="bottom"
                     width="100"/>
            </li>
        </ul>
        <button class="button" ng-class="{disabled: p.train}" ng-click="train()">Train</button>
    </script>

    <ul class="no-bullet">
        <li ng-repeat="p in people">
            <div class="tint"
                 ng-class="{pass: !p.like, like: p.like, train: p.train}"
                 tooltip="Similarity: {{p.photos_similarity_mean}}%"
                 tooltip-placement="bottom"
                 ng-click="open(p)">
                <img ng-src="{{ p.data.photos[0].url }}" width="45"/>
            </div>
        </li>
    </ul>
</div>
<script type="text/javascript">
  angular.module('app', [ 'restangular', 'angularMoment', 'mm.foundation.tooltip', 'mm.foundation.modal' ])
    .config((RestangularProvider) => {
      RestangularProvider.setBaseUrl('/')
    })
    .controller('PeopleController', ($scope, Restangular, $modal) => {
      Restangular.one('/').getList('people')
        .then((list) => {
          $scope.people = list.plain()
        })

      $scope.open = (p) => {

        const params = {
          templateUrl: 'p.html',
          controller: ($scope) => {
            $scope.today = new Date()
            $scope.p = p

            $scope.train = () => {
              Restangular.one(`/train/${p.id}`).post()
                .then(() => {

                })
            }
          }
        }

        $modal.open(params).result.then(() => {}, () => {})
      }
    })
    .run(() => {})
</script>
</body>
</html>
